<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>app/client/admin/js/multirange/multirange.js - OpenVeo Publish AngularJS back end</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo Publish AngularJS back end</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 11.0.2
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/millisecondsToTime.html">millisecondsToTime</a></li>
                                <li><a href="../classes/ovpTime.html">ovpTime</a></li>
                                <li><a href="../classes/publishService.html">publishService</a></li>
                                <li><a href="../classes/timeToMilliseconds.html">timeToMilliseconds</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ov.publish.html">ov.publish</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/client/admin/js/multirange/multirange.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

angular.module(&#x27;ov.multirange&#x27;, [&#x27;ov.multirange.lite&#x27;, &#x27;ov.utils&#x27;])
  .directive(&#x27;ovMultirange&#x27;, [&#x27;ovMultirangeViews&#x27;, function(ovMultirangeViews) {
    return {
      required: &#x27;ngModel&#x27;,
      scope: {
        ngModel: &#x27;=&#x27;,
        _views: &#x27;=views&#x27;,
        _view: &#x27;=view&#x27;,
        duration: &#x27;=duration&#x27;,
        onSelect: &#x27;=&#x27;,
        onMouserelease: &#x27;=&#x27;,
        onEnablemouseover: &#x27;=&#x27;
      },
      template:
        &#x27;&lt;div class=&quot;ov-multirange-mk2-container&quot;&gt;&#x27; +
        &#x27;&lt;ov-multirange-labels render=&quot;renderedStyle&quot; duration=&quot;duration&quot; on-enablemouseover=&quot;onEnablemouseover&quot; &#x27; +
        &#x27;on-select=&quot;onSelect&quot; ng-model=&quot;ranges&quot;&gt;&lt;/ov-multirange-labels&gt;&#x27; +
        &#x27;&lt;ov-multirange-lite ng-model=&quot;ranges&quot; duration=&quot;duration&quot; on-enablemouseover=&quot;onEnablemouseover&quot; &#x27; +
        &#x27;on-select=&quot;onSelect&quot; on-mouserelease=&quot;onMouserelease&quot; ng-style=&quot;renderedStyle.multirange&quot; step=&quot;step&quot;&gt;&#x27; +
        &#x27;&lt;/ov-multirange-lite&gt;&#x27; +
        &#x27;&lt;ov-multirange-hairlines render=&quot;renderedStyle&quot; ng-model=&quot;units&quot;&gt;&lt;/ov-multirange-hairlines&gt;&#x27; +
        &#x27;&lt;/div&gt;&#x27;,
      link: function(scope) {
        scope.ranges = [];

        /**
         * Update ranges if the duration is setted
         */
        function updateRanges() {
          if (scope.duration !== undefined) {
            scope.ranges = scope.ngModel;
          }
        }

        scope.$watch(&#x27;duration&#x27;, updateRanges);
        scope.$watch(&#x27;ngModel&#x27;, updateRanges);

        scope.getPercent = function(value) {
          return (value * 100) + &#x27;%&#x27;;
        };

        scope.changeView = function(n) {
          if (typeof n == &#x27;undefined&#x27; || typeof scope.views == &#x27;undefined&#x27;)
            return;
          var l = scope.views.length - 1,
            view;
          n = (n &lt; 0) ? 0 : ((n &gt; l) ? l : n);
          view = scope.views[n];
          if (typeof view != &#x27;undefined&#x27;) {
            scope.zoom = view.zoom;
            scope.step = view.step;
            scope.units = view.units;
            scope.renderer();
          }
        };

        scope.$watch(&#x27;_view&#x27;, function(n) {
          scope.changeView(n);
        });

        scope.$watch(&#x27;_views&#x27;, function(n) {
          scope.views = n;
          scope.view = 0;
          scope.changeView(0);
        });

        scope.renderer = function() {
          if (typeof scope.zoom == &#x27;undefined&#x27;)
            return;
          var render = {
            container: {},
            content: {},
            multirange: {
              width: scope.getPercent(scope.zoom),
              display: &#x27;block&#x27;,
              margin: &#x27;auto&#x27;
            }
          };

          if (scope.zoom &lt; 1) {
            render.content.margin = &#x27;2 auto&#x27;;
            render.content.width = &#x27;calc(&#x27; + scope.getPercent(scope.zoom) + &#x27; - 10px)&#x27;;
            render.container.marginLeft = &#x27;0&#x27;;
          } else {
            render.content.margin = &#x27;2 0&#x27;;
            render.content.width = &#x27;calc(&#x27; + scope.getPercent(scope.zoom) + &#x27; - &#x27; + (10 - (scope.zoom * 5)) + &#x27;px)&#x27;;
            render.container.marginLeft = &#x27;5px&#x27;;
          }
          return scope.renderedStyle = render;
        };

        // set default view config
        if (typeof scope.views == &#x27;undefined&#x27;) {
          scope.views = ovMultirangeViews.DEFAULT;
          scope.view = 0;
          scope.changeView(0);
        }

      }
    };
  }])
  .directive(&#x27;ovMultirangeLabels&#x27;, function() {
    return {
      restrict: &#x27;E&#x27;,
      scope: {
        ngModel: &#x27;=&#x27;,
        render: &#x27;=&#x27;,
        duration: &#x27;=&#x27;,
        onSelect: &#x27;=&#x27;,
        onEnablemouseover: &#x27;=&#x27;
      },
      template:
        &#x27;&lt;div class=&quot;ov-multirange-mk2-labels-container&quot; ng-style=&quot;render.container&quot;&gt;&#x27; +
        &#x27;&lt;ul class=&quot;ov-multirange-mk2-labels&quot; ng-style=&quot;render.content&quot;&gt;&#x27; +
        &#x27;&lt;li class=&quot;ov-multirange-mk2-label&quot; ng-class=&quot;{\&#x27;active\&#x27;:range.select}&quot; ng-repeat=&quot;range in ngModel&quot; &#x27; +
        &#x27;ng-style=&quot;renderRange(range)&quot; ng-mouseover=&quot;mouseover(range, onSelect, onEnablemouseover)&quot; &gt;&#x27; +
        &#x27;&lt;span ng-if=&quot;range.name &amp;&amp; !range.type&quot;&gt;{{ range.name }}&lt;/span&gt;&#x27; +
        &#x27;&lt;span ng-if=&quot;!range.name &amp;&amp; !range.type&quot;&gt;&lt;div class=&quot;glyphicon glyphicon-map-marker&quot;&gt;&lt;/div&gt;&lt;/span&gt;&#x27; +
        &#x27;&lt;span ng-if=&quot;range.type &amp;&amp; range.type==\&#x27;begin\&#x27;&quot; ng-class=&quot;range.type&quot;&gt;&#x27; +
        &#x27;&lt;div class=&quot;glyphicon glyphicon-log-out&quot;&gt;&#x27; +
        &#x27;&lt;/div&gt;&lt;/span&gt;&#x27; +
        &#x27;&lt;span ng-if=&quot;range.type &amp;&amp; range.type==\&#x27;end\&#x27;&quot; ng-class=&quot;range.type&quot;&gt;&#x27; +
        &#x27;&lt;div class=&quot;glyphicon glyphicon-log-in&quot;&gt;&lt;/div&gt;&lt;/span&gt;&#x27; +
        &#x27;&lt;/li&gt;&#x27; +
        &#x27;&lt;/ul&gt;&#x27; +
        &#x27;&lt;/div&gt;&#x27;,
      link: function(scope) {
        scope.renderRange = function(range) {
          return {
            left: (range.value / scope.duration) * 100 + &#x27;%&#x27;,
            zIndex: range._depth
          };
        };
        scope.mouseover = function(range, select, condition) {
          if (!range.select &amp;&amp; condition)
            select(range);
        };
      }
    };
  })
  .directive(&#x27;ovMultirangeHairlines&#x27;, function() {
    return {
      restrict: &#x27;E&#x27;,
      scope: {
        ngModel: &#x27;=&#x27;,
        render: &#x27;=&#x27;
      },
      template:
        &#x27;&lt;div class=&quot;ov-multirange-mk2-hairlines-container&quot; ng-style=&quot;render.container&quot;&gt;&#x27; +
        &#x27;&lt;ul class=&quot;ov-multirange-mk2-hairlines&quot; ng-style=&quot;render.content&quot;&gt;&#x27; +
        &#x27;&lt;li class=&quot;ov-multirange-mk2-hairline&quot; ng-repeat=&quot;hairline in hairlines&quot; ng-style=&quot;hairline.render&quot;&gt;&#x27; +
        &#x27;&lt;span&gt;{{ hairline.label }}&lt;/span&gt;&#x27; +
        &#x27;&lt;/li&gt;&#x27; +
        &#x27;&lt;/ul&gt;&#x27; +
        &#x27;&lt;/div&gt;&#x27;,
      link: function(scope) {

        scope.$watch(&#x27;ngModel&#x27;, function(n) {
          if (typeof n == &#x27;undefined&#x27;)
            return;
          scope.hairlines = [];
          var levels = n.length,
            hairHeight = 12,
            hairline,
            i,
            j,
            u;
          for (i = 0; i &lt; levels; i++) {
            u = n[i];
            for (j = 0; ((j &gt; 1) ? Math.round(j * 1000) / 1000 : j) &lt;= 1; j = parseFloat((j + u.value).toFixed(8))) {
              hairline = {
                render: {
                  height: hairHeight * (1 - i / levels),
                  left: (j * 100) + &#x27;%&#x27;
                }
              };
              if (typeof u.labeller == &#x27;function&#x27;) {
                hairline.label = u.labeller(j);
              } else if (typeof u.labeller != &#x27;undefined&#x27;) {
                hairline.label = j;
              }
              scope.hairlines.push(hairline);
            }
          }
        });

      }
    };
  })
  .factory(&#x27;ovMultirangeViews&#x27;, [&#x27;ovUtils&#x27;, function(ovUtils) {
    var tv = ovUtils.time.fromTimeToValue,
      vt = ovUtils.time.fromValueToTime;

    return {
      TIME: function(duration) {
        var zoomArray = [];
        var level = 0;
        if (duration &gt; 3600000) { // 1h
          level = 1;
        } else if (duration &gt; 1800000) { // 30min
          level = 2;
        } else if (duration &gt; 600000) { // 10min
          level = 3;
        } else {
          level = 4;
        }
        var labeller = function(n) {
          var time = vt(n, duration);
          var label = time.hours != 0 ? time.hours + &#x27;h&#x27; : &#x27;&#x27;;
          return label + time.minutes + &#x27;m&#x27;;
        };
        var zoom = [0.9, 2, 4, 8];

        for (level; level &lt;= 4; level++) {
          if (level == 1) {
            zoomArray.push({
              zoom: zoom[zoomArray.length],
              step: tv(0, 1, 0, duration),
              units: [
                {
                  value: tv(0, 20, 0, duration),
                  labeller: labeller
                },
                {
                  value: tv(0, 5, 0, duration)
                }
              ]
            });
          }
          if (level == 2) {
            zoomArray.push({
              zoom: zoom[zoomArray.length],
              step: tv(0, 0, 10, duration),
              units: [
                {
                  value: tv(0, 10, 0, duration),
                  labeller: labeller
                },
                {
                  value: tv(0, 2, 0, duration)
                }
              ]
            });
          }
          if (level == 3) {
            zoomArray.push({
              zoom: zoom[zoomArray.length],
              step: tv(0, 0, 1, duration),
              units: [
                {
                  value: tv(0, 5, 0, duration),
                  labeller: labeller
                },
                {
                  value: tv(0, 1, 0, duration)
                }
              ]
            });
          }
          if (level == 4) {
            zoomArray.push({
              zoom: zoom[zoomArray.length],
              step: tv(0, 0, 1, duration),
              units: [
                {
                  value: tv(0, 2, 0, duration),
                  labeller: labeller
                },
                {
                  value: tv(0, 0, 30, duration)
                }
              ]
            });
          }
        }

        return zoomArray;
      }
    };
  }]);

angular.module(&#x27;ov.multirange.lite&#x27;, [])
  .directive(&#x27;ovMultirangeLite&#x27;, function() {
    return {
      required: &#x27;ngModel&#x27;,
      scope: {
        ngModel: &#x27;=&#x27;,
        step: &#x27;=&#x27;,
        duration: &#x27;=&#x27;,
        onSelect: &#x27;=&#x27;,
        onMouserelease: &#x27;=&#x27;,
        onEnablemouseover: &#x27;=&#x27;
      },
      template:
        &#x27;&lt;div class=&quot;ov-multirange-container&quot; ng-mousemove=&quot;onMouseMove($event, onEnablemouseover)&quot;&gt;&#x27; +
        &#x27;&lt;div class=&quot;ov-multirange-track&quot;&gt;&lt;/div&gt;&#x27; +
        &#x27;&lt;div class=&quot;ov-multirange-wrapper&quot; ng-repeat=&quot;range in ngModel&quot; ng-style=&quot;computeDepth(range)&quot; &#x27; +
        &#x27;ng-mouseup=&quot;mouserelease(onMouserelease, range)&quot; &#x27; +
        &#x27;ng-mouseover=&quot;mouseover(range, onSelect, onEnablemouseover)&quot; &gt;&#x27; +
        &#x27;&lt;ov-range class=&quot;ov-multirange&quot; duration=&quot;duration&quot; ng-class=&quot;{\&#x27;active\&#x27;:range.select}&quot; &#x27; +
        &#x27;position=&quot;range.value&quot; min=&quot;0&quot; max=&quot;{{ duration }}&quot; step=&quot;{{ preciseStep }}&quot;&gt;&#x27; +
        &#x27;&lt;/div&gt;&#x27; +
        &#x27;&lt;/div&gt;&#x27;,
      link: function(scope, elem) {
        var mousex;
        scope.precision = scope.duration;
        scope.preciseStep = 1000;
        scope.onMouseMove = function(evt, condition) {
          if (condition) {
            var bound = elem[0].getBoundingClientRect();
            mousex = Math.min((evt.pageX - bound.left) / bound.width, 1);
          }
        };
        scope.mouserelease = function(release, range) {
          release(range);
        };
        scope.mouseover = function(range, select, condition) {
          if (!range.select &amp;&amp; condition)
            select(range);
        };
        scope.computeDepth = function(range) {
          range._depth = 100 - Math.round(Math.abs(mousex - range.value / scope.duration) * 100);
          return {
            zIndex: range._depth
          };
        };
      }
    };
  })
  .directive(&#x27;ovRange&#x27;, function() {
    return {
      template: &#x27;&lt;input type=&quot;range&quot; ng-model=&quot;position&quot;&gt;&#x27;,
      require: [&#x27;?ngModel&#x27;],
      restrict: &#x27;E&#x27;,
      replace: true,
      scope: {
        position: &#x27;=&#x27;
      },
      link: function(scope, elem, attr, controllers) {
        var ngModelCtrl = controllers[0];

        ngModelCtrl.$parsers.push(function(n) {
          return parseInt(n);
        });

        elem.bind(&#x27;click&#x27;, function(event) {
          event.preventDefault();
          event.stopPropagation();
        });
      }
    };
  });

angular.module(&#x27;ov.utils&#x27;, [])
  .factory(&#x27;ovUtils&#x27;, function() {
    return {
      time: {
        fromTimeToValue: function(hours, minutes, second, dayConst) {
          var d = new Date(0);
          d.setUTCHours(hours);
          d.setUTCMinutes(minutes);
          d.setUTCSeconds(second);
          return d.getTime() / dayConst;
        },
        fromValueToTime: function(value, dayConst) {
          var d = new Date(Math.round(dayConst * value));
          return {
            hours: d.getUTCHours() + ((d.getUTCDate() - 1) * 24),
            minutes: d.getUTCMinutes(),
            seconds: d.getUTCSeconds()
          };
        }
      },
      format: {
        padZeroes: function(num, size) {
          var s = &#x27;000000000&#x27; + num;
          return s.substr(s.length - size);
        }
      }
    };
  });

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
