<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ovPub/ConfigurationController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ovPub/ConfigurationController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

(function(app) {

  /**
   * Defines the configuration controller for the configuration page.
   *
   * @class ConfigurationController
   * @memberof module:ov.publish
   * @inner
   * @ignore
   */
  function ConfigurationController(
    $scope,
    publishConf,
    publishService,
    utilService,
    $filter,
    groups,
    users,
    properties
  ) {
    var publishWatcher = publishConf.data.publishWatcher;
    var publishTls = publishConf.data.publishTls;
    var publishCatalog = publishConf.data.publishCatalog;

    $scope.rights = {};
    $scope.rights.edit = $scope.checkAccess('publish-manage-publish-config');

    // Youtube settings
    $scope.youtubeConf = publishConf.data.youtube;

    // Watcher settings
    $scope.watcherSettings = {
      model: {
        owner: (publishWatcher &amp;&amp; publishWatcher.owner) || null,
        group: (publishWatcher &amp;&amp; publishWatcher.group) || null
      },
      fields: [
        {
          key: 'owner',
          type: 'editableSelect',
          wrapper: 'editableWrapper',
          templateOptions: {
            label: $filter('translate')('PUBLISH.CONFIGURATION.WATCHER_DEFAULT_OWNER'),
            options: utilService.buildSelectOptions(users.data.entities)
          }
        },
        {
          key: 'group',
          type: 'editableSelect',
          wrapper: 'editableWrapper',
          templateOptions: {
            label: $filter('translate')('PUBLISH.CONFIGURATION.WATCHER_DEFAULT_GROUP'),
            options: utilService.buildSelectOptions(groups.data.entities)
          }
        }
      ],
      options: {
        formState: {
          showForm: $scope.rights.edit
        }
      },
      isFormSaving: false
    };

    // TLS settings
    if (publishTls) {
      $scope.tlsSettings = {
        model: {
          properties: publishTls.properties || []
        },
        fields: [
          {
            key: 'properties',
            type: 'editableTags',
            wrapper: ['editableWrapper', 'bootstrapLabel', 'bootstrapHasError'],
            templateOptions: {
              label: $filter('translate')('PUBLISH.CONFIGURATION.TLS_PROPERTIES'),
              availableOptions: utilService.buildSelectOptions(properties.data.entities)
            }
          }
        ],
        options: {
          formState: {
            showForm: $scope.rights.edit
          }
        },
        isFormSaving: false
      };
    }

    // Catalog settings
    $scope.catalogSettings = {
      model: {
        refreshInterval: (publishCatalog &amp;&amp; publishCatalog.refreshInterval) || null
      },
      fields: [
        {
          key: 'refreshInterval',
          type: 'editableInput',
          wrapper: ['editableWrapper', 'bootstrapHasError'],
          validators: {
            number: {
              expression: function(viewValue, modelValue) {
                return !viewValue || /^[0-9]*$/.test(viewValue);
              }
            }
          },
          templateOptions: {
            label: $filter('translate')('PUBLISH.CONFIGURATION.CATALOG_REFRESH_INTERVAL')
          }
        }
      ],
      options: {
        formState: {
          showForm: $scope.rights.edit
        }
      },
      isFormSaving: false
    };

    /**
     * Saves medias settings.
     */
    $scope.saveWatcherSettings = function() {
      $scope.watcherSettings.isFormSaving = true;

      return publishService.saveWatcherSettings({
        owner: $scope.watcherSettings.model.owner || undefined,
        group: $scope.watcherSettings.model.group || undefined
      }).then(function() {
        $scope.watcherSettings.isFormSaving = false;
        $scope.$emit('setAlert', 'success', $filter('translate')('CORE.UI.SAVE_SUCCESS'), 4000);
      }).catch(function() {
        $scope.watcherSettings.isFormSaving = false;
      });
    };

    /**
     * Saves TLS settings.
     */
    $scope.saveTlsSettings = function() {
      $scope.tlsSettings.isFormSaving = true;

      return publishService.saveTlsSettings({
        properties: $scope.tlsSettings.model.properties
      }).then(function() {
        $scope.tlsSettings.isFormSaving = false;
        $scope.$emit('setAlert', 'success', $filter('translate')('CORE.UI.SAVE_SUCCESS'), 4000);
      }).catch(function() {
        $scope.tlsSettings.isFormSaving = false;
      });
    };

    /**
     * Saves catalog settings.
     */
    $scope.saveCatalogSettings = function() {
      $scope.catalogSettings.isFormSaving = true;

      return publishService.saveCatalogSettings({
        refreshInterval: $scope.catalogSettings.model.refreshInterval
      }).then(function() {
        $scope.catalogSettings.isFormSaving = false;
        $scope.$emit('setAlert', 'success', $filter('translate')('CORE.UI.SAVE_SUCCESS'), 4000);
      }).catch(function() {
        $scope.catalogSettings.isFormSaving = false;
      });
    };

  }

  app.controller('ConfigurationController', ConfigurationController);
  ConfigurationController.$inject = [
    '$scope', 'publishConf', 'publishService', 'utilService', '$filter', 'groups', 'users', 'properties'];

})(angular.module('ov.publish'));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="ov.module_publish.html">ov.publish</a></li><li><a href="ov.module_publish_multirange.html">ov.publish/multirange</a></li></ul><h3>Classes</h3><ul><li><a href="module-ov.publish-MillisecondsToTime.html">ov.publish~MillisecondsToTime</a></li><li><a href="module-ov.publish-ovpTime.html">ov.publish~ovpTime</a></li><li><a href="module-ov.publish-PublishService.html">ov.publish~PublishService</a></li><li><a href="module-ov.publish-TimeToMilliseconds.html">ov.publish~TimeToMilliseconds</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri May 27 2022 07:50:36 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
